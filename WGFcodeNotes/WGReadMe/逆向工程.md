## 逆向工程
### 1. 学习条件
1. 调试设备: 建议至少iPhone 5S(因为从5s开始才支持arm64架构)
2. iOS9.1 完美越狱: 至少iOS8完美越狱;版本不能太高,要保证能够完美越狱
3. 检查手机是否可以越狱:https://jailbreak.25pp.com/ios(该网站暂时打不开)

### 2. iOS越狱(iOS Jailbreak)
#### 什么是iOS越狱?利用iOS系统的漏洞,获取iOS系统的最高权限(Root),解开之前的各种限制(合法行为)
* 越狱优点

        1. 打造个性化、与众不同的iPhone
        2. 自由安装各种实用的插件、主题、APP
        3. 修改系统APP的一些默认行为
        4. 自由安装非AppStore来源的APP
        5. “付费APP” 秒变“免费APP”
        6. 未越狱iPhone安装APP的路径:AppStore、真机调试、通过证书打包ipa安装包
        7. 灵活管理文件系统,让iPhone可以像U盘那样灵活
        8. 给开发者提供了逆袭工程的环境
* 越狱缺点

        1. 不予保修
        2. 费电,越狱后的iOS系统会常驻一些进程,耗电速度约提升10%-20%
        3. 在新的iOS固件版本出来的时候,不能及时地进行更新
        4. 每个新版本的固件,都会修复上一个版本的越狱漏洞,使越狱失效
        5. 如果需要保持越狱状态,要等待新的越狱程序发布时,才能升级相应的固件版本
        6. 不再受iOS系统默认的安全保护,容易被恶意软件攻击,个人隐私有被窃取的风险
        7. 如果安装了不稳定的插件,容易让系统变得不稳定、变慢,甚至出现“白苹果”等问题

#### 2.1 完美越狱和不完美预约
* 完美越狱:

        越狱后的iPhone可以正常关机和重启
* 不完美越狱: 

        iPhone一旦关机后再开机时,屏幕就会一直停留在启动画面,也就是“白苹果”状态
        或者能正常开机,但已经安装的破解软件都无法正常使用,需要将设别与PC连接后,使用软件进行引导才能使用
* 越狱方法推荐: PP助手:http://jailbreak.25pp.com
#### 一般来说,在苹果发布新的iOS固件后,针对该固件的不完美越狱会先发布,随后完美越狱才可能发布,一般较新的系统版本,均为不完美越狱

#### 2.2 如何判断是否越狱成功?
1. 手机桌面是否有Cydia APP;Cydia APP就是越狱后的“App Store”,作者是Jay FreeMan可以在Cydia中安装各种第三方的软件(插件、补丁、APP)
2. 工具判断(比如pp助手),若越狱了,则pp助手上会显示是否越狱:是

### 3. SSH
#### 我们经常在Mac的终端上,通过敲一些命令行来完成一些操作,iOS和Mac OS X都是基于Darwin(苹果的一个基于Unix的开源系统内核),所以iOS中同样支持终端的命令行操作;在逆向工程中,我们经常会通过命令行来操纵iPhone,为了能够让Mac终端中的命令行能作用在iPhone上,我们需要让Mac和iPhone建立连接;通过Mac远程登录到iPhone的方式建立连接
                   远程登录
        Mac ---------------------> iPhone
                  终端命令行

#### SSH(Secure Shell),意为“安全外壳协议”,是一种可以为**远程登录**提供安全保障的协议;使用SSH,可以把所有传输的数据进行加密,“中间人”攻击方式就不可能实现,能防止DNS欺骗和IP欺骗
            client--tcp---------SSH---------tcp--server
                                 |
                                 ❌
                                 |
                        sniffer(嗅探器/抓数据包软件)
#### OpenSSH: 是SSH协议的免费开源实现,可以通过OpenSSH的方式让Mac远程登录到iPhone; OpenSSH工具可以在iPhone上通过Cydia安装(软件源http://apt.saurik.com)

### 3.1 使用OpenSSH远程登录使用步骤
#### SSH是通过TCP协议通信,所以要确保Mac和iPhone在同一个局域网下(连接同一个WI-FI)
1. 在Mac的终端输入: ssh 账户名@服务器主机地址; 例如 ssh root@10.1.1.168(这里的服务器是手机,即手机连接的Wi-Fi所对应的IP地址)
2. 初始化密码是:alpine
3. 登录成功后就可以使用终端命令行操作iPhone; 退出登录在终端输入: exit
4. ios下有2个常用账户: root、mobile;

        root: 最高权限账户,$HOME是/var/root; 
        mobile:普通权限账户,,$HOME是/var/mobile,只能操作一些普通文件,不能操作系统级别的文件
        在命令行中若出现#符号,则表示最高权限账户; 若出现$符号,则是普通账户权限
        登录mobile用户: ssh mobile@服务器IP地址; root和mobile用户的初始登录密码都是alpine
5. 最好修改下root、mobile的初始密码; 终端输入:passwd 修改root密码;终端输入passwd mobile 修改mobile密码

### 3.2 SSL、OpenSSL
#### SSL(Secure Sockets Layer),是为网络通信提供安全及数据完整性的一种安全协议,在传输层对网络连接进行加密; OpenSSL是SSL的开源实现,绝大部分HTTPS请求等价于:HTTP+OpenSSL; OpenSSH的加密就是通过OpenSSL完成的

#### OpenSSH是为了保证我们远程登录是安全的,那么怎么保证安全那?就是通过OpenSSL来实现的,即OpenSSH的加密是由OpenSSL来完成的

### 3.3 SSH通信过程
#### SSH协议一共有2个版本:SSH-1、SSH-2,现在用的比较多的是SSH-2,客户端和服务端版本要保持一致才能通信;如何查看SSH版本
    查看SSH版本(查看配置文件的Protocol字段即可  1代表SSH-1,2代表SSH-2)
    客户端: /etc/ssh/ssh_config
    服务端: /etc/ssh/sshd_config

#### SSH通信过程可以分为3大主要阶段
1. 建立安全连接
2. 客户端认证
3. 数据传输

#### 3.3.1 建立安全连接
#### 在建立安全连接过程中,服务器会提供自己的身份证明
        客户端Mac                               服务器端iPhone
                                               公钥(/etc/ssh/ssh_host_rsa_key.pub)
                                               私钥(/etc/ssh/ssh_host_rsa_key)
                       服务器发送公钥等信息给客户端                     
    ~/.ssh/known_hosts<------------------------               
    客户端保存公钥到该路径下
#### 服务端发送公钥给客户端,客户端拿到公钥后,首先检查~/.ssh/known_hosts文件中,是否之前保存有该公钥等信息,若没有,客户端拿到公钥等信息后,就知道服务端是谁了,客户端开始确认要不要连接这个服务端,如果是要连接的服务端,那么就建立连接,同时将公钥等信息保存到~/.ssh/known_hosts文件下;若~/.ssh/known_hosts文件中有公钥等信息,那么就直接确认要建立连接; 我们在Mac终端第一次输入**ssh root@10.1.1.168**,去远程登录iPhone时,会弹出一个提示信息,让输入yes or no,一般我们都输入yes,这个地方其实就是在询问我们要否连接该服务器(即iPhone),输入yes表示同意连接到该服务器,并且会将服务器端(即iPhone)发送过来的公钥等信息保存到~/.ssh/known_hosts文件下

#### 服务器身份信息变更
#### 在建立安全连接过程中,可能会遇到以下错误信息:提醒服务器的身份信息发生了变更,可能会遭受中间人攻击;例如我们曾经连接过的服务器(iPhone的ip地址),已经保存公钥等信息到~/.ssh/known_hosts文件下了,当我们再次连接时,连接同样的ip地址,但是发现服务器(iPhone)发送过来的公钥等信息在~/.ssh/known_hosts文件下并没有,说明公钥信息对不上了,有可能是别人伪造的,所以这种情况下当我们远程登录服务端(iPhone)时,在Mac终端会提示此类错误信息

#### 有些情况并一定是遭受到了中间人攻击才导致服务器身份信息变更,例如公司有两台服务器,有时候用A,有时候用B,我们完全可以设置这两台电脑的ip地址是一样的,




#### 3.3.2 客户端认证










#### 3.3.3 数据传输












































